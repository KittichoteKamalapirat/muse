version: 2.1

orbs:
  node: circleci/node@4.7

# all pipeline parameters need to be defined equally for both the setup workflow
# and main workflows - these parameters will be passed to both of them
parameters:
  run-setup:
    description: Whether it is a setup workflow or a continuation
    type: boolean
    default: true
  force-all:
    description: Emergency valve - forcibly build all the modules
    type: boolean
    default: false

workflows:
  setup-workflow:
    when: << pipeline.parameters.run-setup >>
    jobs:
      - config-splitting/setup-dynamic-config:
          force-all: << pipeline.parameters.force-all >>
          base-revision: master
          # if pitch is modified, the job for pitch will run
          # similarly, if vulcan is modified, the job for vulcan will run
          modules: |
            packages/client
            packages/server
